<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat</title>
    <meta
      name="gallery description"
      content="A 18+ free AI Hentai Generated Gallery, Check out the galleries free AI generated hentai!"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="https://i.postimg.cc/fTYbH36n/brand-logo.png"
    />
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined"
      rel="stylesheet"
    />
    <script>
      (function (w, r) {
        w._rwq = r;
        w[r] =
          w[r] ||
          function () {
            (w[r].q = w[r].q || []).push(arguments);
          };
      })(window, "rewardful");
    </script>
    <script
      async
      src="https://r.wdfl.co/rw.js"
      data-rewardful="52d969"
    ></script>
    <script
      src="https://www.dwin1.com/65546.js"
      type="text/javascript"
      defer="defer"
    ></script>
  </head>

  <body>
    <button class="menu-button" id="toggle-sidebar">â˜°</button>
    <div class="header-new">
      <div class="header-new__logo">
        <a href="/">
          <img
            width="90"
            src="https://i.postimg.cc/fTYbH36n/brand-logo.png"
            alt=""
          />
        </a>
      </div>

      <div class="header-new__links">
        <ul>
          <li>
            <a href="/">Create</a>
          </li>
          <li>
            <a href="/edit">Edit</a>
          </li>
          <li>
            <a href="/gallery">Gallery</a>
          </li>
          <li>
            <a href="/image-explore">Explore</a>
          </li>
          <li>
            <a href="https://info.aihentaigenerator.net/rules/">Rules</a>
          </li>
          <li>
            <a href="https://info.aihentaigenerator.net/contact-us/">Contact</a>
          </li>
          <li>
            <a href="/subscription">Subscription</a>
          </li>
          <li>
            <a href="https://www.aihentaigenerator.net/logout">Logout</a>
          </li>
        </ul>
      </div>

      <div class="header-new__actions">
        <a href="https://www.aihentaigenerator.net/login">
          <button class="header-button">Sign In</button>
        </a>
        <a href="https://www.aihentaigenerator.net/create-account">
          <button class="header-button2">Register</button>
        </a>
      </div>
    </div>

    <div class="sidebar" id="sidebar">
      <div class="menu-items">
        <a href="https://www.aihentaigenerator.net/">Home</a>
        <a href="https://shop.aihentaigenerator.net/">Shop</a>
        <a href="https://info.aihentaigenerator.net/faq/">FAQ</a>
        <a href="https://info.aihentaigenerator.net/rules/">Rules</a>
        <a href="https://info.aihentaigenerator.net/contact-us/">Contact</a>
        <a href="https://info.aihentaigenerator.net/subscription">Subscription</a>
        <a href="https://www.aihentaigenerator.net/gallery">Gallery</a>
        <a href="https://www.aihentaigenerator.net/logout">Logout</a>
      </div>
    </div>

    <div class="panel">
      <div class="chat">
        <div class="chat__list">
          <div class="chat__list-header">
            <div>
              <b>Chats</b>
              <a
                ><img
                  src="https://i.postimg.cc/767MdvqX/settings-icon.png"
                  alt=""
              /></a>
            </div>
          </div>
          <div class="chat__search">
            <input type="text" placeholder="Search" />
            <img src="https://i.postimg.cc/FK0Vn5rp/search-icon.png" alt="" />
          </div>
          <div class="chat__list-scroll">
            <div class="chat__person-box">
              <a onclick="showChatConversationSection()">
                <div class="flex justify-between align-start">
                  <div class="flex justify-start align-center">
                    <div>
                      <img
                        src="https://i.postimg.cc/HWXCW20R/chat-sidebar-image.png"
                        alt=""
                      />
                    </div>
                    <div><b>Jason Doe</b></div>
                  </div>
                  <div>
                    <span>00:12</span>
                  </div>
                </div>
                <div class="m-1">
                  <small>Are you there?</small>
                </div>
              </a>
            </div>
            <div class="chat__person-box active">
              <a onclick="showChatConversationSection()">
                <div class="flex justify-between align-start">
                  <div class="flex justify-start align-center">
                    <div>
                      <img
                        src="https://i.postimg.cc/HWXCW20R/chat-sidebar-image.png"
                        alt=""
                      />
                    </div>
                    <div><b>Jason Doe</b></div>
                  </div>
                  <div>
                    <span>00:12</span>
                  </div>
                </div>
                <div class="m-1">
                  <small>Are you there?</small>
                </div>
              </a>
            </div>
            <div class="chat__person-box">
              <a onclick="showChatConversationSection()">
                <div class="flex justify-between align-start">
                  <div class="flex justify-start align-center">
                    <div>
                      <img
                        src="https://i.postimg.cc/HWXCW20R/chat-sidebar-image.png"
                        alt=""
                      />
                    </div>
                    <div><b>Jason Doe</b></div>
                  </div>
                  <div>
                    <span>00:12</span>
                  </div>
                </div>
                <div class="m-1">
                  <small>Are you there?</small>
                </div>
              </a>
            </div>
            <div class="chat__person-box">
              <a onclick="showChatConversationSection()">
                <div class="flex justify-between align-start">
                  <div class="flex justify-start align-center">
                    <div>
                      <img
                        src="https://i.postimg.cc/HWXCW20R/chat-sidebar-image.png"
                        alt=""
                      />
                    </div>
                    <div><b>Jason Doe</b></div>
                  </div>
                  <div>
                    <span>00:12</span>
                  </div>
                </div>
                <div class="m-1">
                  <small>Are you there?</small>
                </div>
              </a>
            </div>
            <div class="chat__person-box">
              <a onclick="showChatConversationSection()">
                <div class="flex justify-between align-start">
                  <div class="flex justify-start align-center">
                    <div>
                      <img
                        src="https://i.postimg.cc/HWXCW20R/chat-sidebar-image.png"
                        alt=""
                      />
                    </div>
                    <div><b>Jason Doe</b></div>
                  </div>
                  <div>
                    <span>00:12</span>
                  </div>
                </div>
                <div class="m-1">
                  <small>Are you there?</small>
                </div>
              </a>
            </div>
            <div class="chat__person-box">
              <a onclick="showChatConversationSection()">
                <div class="flex justify-between align-start">
                  <div class="flex justify-start align-center">
                    <div>
                      <img
                        src="https://i.postimg.cc/HWXCW20R/chat-sidebar-image.png"
                        alt=""
                      />
                    </div>
                    <div><b>Jason Doe</b></div>
                  </div>
                  <div>
                    <span>00:12</span>
                  </div>
                </div>
                <div class="m-1">
                  <small>Are you there?</small>
                </div>
              </a>
            </div>
            <div class="chat__person-box">
              <a onclick="showChatConversationSection()">
                <div class="flex justify-between align-start">
                  <div class="flex justify-start align-center">
                    <div>
                      <img
                        src="https://i.postimg.cc/HWXCW20R/chat-sidebar-image.png"
                        alt=""
                      />
                    </div>
                    <div><b>Jason Doe</b></div>
                  </div>
                  <div>
                    <span>00:12</span>
                  </div>
                </div>
                <div class="m-1">
                  <small>Are you there?</small>
                </div>
              </a>
            </div>
            <div class="chat__person-box">
              <a onclick="showChatConversationSection()">
                <div class="flex justify-between align-start">
                  <div class="flex justify-start align-center">
                    <div>
                      <img
                        src="https://i.postimg.cc/HWXCW20R/chat-sidebar-image.png"
                        alt=""
                      />
                    </div>
                    <div><b>Jason Doe</b></div>
                  </div>
                  <div>
                    <span>00:12</span>
                  </div>
                </div>
                <div class="m-1">
                  <small>Are you there?</small>
                </div>
              </a>
            </div>
            <div class="chat__person-box">
              <a onclick="showChatConversationSection()">
                <div class="flex justify-between align-start">
                  <div class="flex justify-start align-center">
                    <div>
                      <img
                        src="https://i.postimg.cc/HWXCW20R/chat-sidebar-image.png"
                        alt=""
                      />
                    </div>
                    <div><b>Jason Doe</b></div>
                  </div>
                  <div>
                    <span>00:12</span>
                  </div>
                </div>
                <div class="m-1">
                  <small>Are you there?</small>
                </div>
              </a>
            </div>
          </div>
        </div>
        <div class="expanded-chat" id="chatUI">
          <div class="chat__conversation-header">
            <div class="flex justify-between align-start">
              <div class="flex justify-start align-center">
                <div class="back-icon">
                  <a onclick="showChatListSection()">
                    <img
                      src="https://i.postimg.cc/tgVDFnns/back-icon.png"
                      alt=""
                    />
                  </a>
                </div>
                <div>
                  <img
                    src="https://i.postimg.cc/HWXCW20R/chat-sidebar-image.png"
                    alt=""
                  />
                </div>
                <div>
                  <b>Jason Doe</b>
                  <small>5 min ago</small>
                </div>
              </div>
              <div class="conversation-icon">
                <a
                  ><img
                    src="https://i.postimg.cc/7LM9B8X4/call-icon.png"
                    alt=""
                /></a>
                <a onclick="showHideProfileSection()"
                  ><img
                    src="https://i.postimg.cc/Kcs67BRN/profile-open-icon.png"
                    alt=""
                /></a>
              </div>
            </div>
          </div>
          <div class="chat__conversation-box" id="chatHistory">
            <!-- Chat messages will be appended here -->
          </div>
          <div class="chat__conversation-footer">
            <form id="chatForm">
              <div class="flex justify-between align-center">
                <div class="width-1">
                  <select name="messageType" id="messageType">
                    <option value="ask">Ask</option>
                    <option value="show_me">Show me..</option>
                    <option value="send_me">Send me..</option>
                    <option value="send">Send..</option>
                    <option value="can_i_see">Can I See..</option>
                  </select>
                  <input type="text" id="question" placeholder="Type a message" />
                  <input type="hidden" id="character" value="Jason Doe" />
                </div>
                <div class="width-2">
                  <button type="submit">
                    <img src="https://i.postimg.cc/cCC493yS/send-icon.png" alt="" /><span>Send</span>
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
        <div class="no-profile" id="profileUI">
          <div class="chat__list-header">
            <div>
              <b>Profile Information</b>
              <a onclick="hideProfileSection()"
                ><img src="https://i.postimg.cc/5NFFbhTM/close-icon.png" alt=""
              /></a>
            </div>
          </div>
          <div class="personal-info">
            <div class="flex justify-center align-center flex-column">
              <div class="profile-image">
                <img
                  src="https://i.postimg.cc/wM9Dn2cZ/profile-image.png"
                  alt=""
                  class="slide"
                />
                <img
                  src="https://i.postimg.cc/wM9Dn2cZ/profile-image.png"
                  alt=""
                  class="slide"
                />
                <img
                  src="https://i.postimg.cc/wM9Dn2cZ/profile-image.png"
                  alt=""
                  class="slide"
                />
                <a class="left-arrow" onclick="goPrev()"
                  ><img
                    src="https://i.postimg.cc/wMYcp923/chevron-left-profile.png"
                    alt=""
                /></a>
                <a class="right-arrow" onclick="goNext()"
                  ><img
                    src="https://i.postimg.cc/0Qs0g8cj/chevron-right-profile.png"
                    alt=""
                /></a>
              </div>
              <div class="m-1"><b>Sam Turner</b></div>
              <div>
                <small
                  >Active Yoga and fitness coach, healthy and concerned about
                  others.</small
                >
              </div>
              <div class="flex">
                <a
                  ><img
                    src="https://i.postimg.cc/JzNprrzf/call-profile-icon.png"
                    alt=""
                /></a>
                <a
                  ><img
                    src="https://i.postimg.cc/zBrbJN3c/generate-icon.png"
                    alt=""
                /></a>
              </div>
            </div>
            <div class="flex justify-center align-center attributes">
              <div class="border-line"></div>
              <span>Personality Attributes</span>
              <div class="border-line"></div>
            </div>
            <div class="flex justify-start align-center attributes">
              <div class="gray-round">
                <img
                  src="https://i.postimg.cc/pTmWb1J6/personality-icon.png"
                  alt=""
                />
              </div>
              <div><small>Personality</small><b>Energetic & Joyful</b></div>
            </div>
            <div class="flex justify-start align-center attributes">
              <div class="gray-round">
                <img
                  src="https://i.postimg.cc/tRV6FrGk/occupation-icon.png"
                  alt=""
                />
              </div>
              <div><small>Occupation</small><b>Yoga & Fitness Coach</b></div>
            </div>
            <div class="flex justify-start align-center attributes">
              <div class="gray-round">
                <img
                  src="https://i.postimg.cc/tC4HLcRt/hobby-icon.png"
                  alt=""
                />
              </div>
              <div><small>Hobbies</small><b>Yoga, Fitness, Nature</b></div>
            </div>
            <div class="flex justify-start align-center attributes">
              <div class="gray-round">
                <img
                  src="https://i.postimg.cc/YCxDMrXv/relationship-icon.png"
                  alt=""
                />
              </div>
              <div><small>Relationship</small><b>Married</b></div>
            </div>
            <div class="flex justify-center align-center attributes">
              <div class="border-line"></div>
              <span>Physical Attributes</span>
              <div class="border-line"></div>
            </div>
            <div class="flex justify-start align-center attributes">
              <div class="gray-round">
                <img src="https://i.postimg.cc/RC2vHBcs/body-icon.png" alt="" />
              </div>
              <div><small>Body</small><b>Athletic</b></div>
            </div>
            <div class="flex justify-start align-center attributes">
              <div class="gray-round">
                <img src="https://i.postimg.cc/qqrq2HKC/age-icon.png" alt="" />
              </div>
              <div><small>Age</small><b>51 years</b></div>
            </div>
            <div class="flex justify-start align-center attributes">
              <div class="gray-round">
                <img
                  src="https://i.postimg.cc/nM8k4zkG/ethinicity-icon.png"
                  alt=""
                />
              </div>
              <div><small>Ethnicity</small><b>American</b></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    {% include 'modal.html' %}
  </body>
  <script>
    window.trackingId = "{{ tracking_id }}";
  </script>
  <!-- Google tag (gtag.js) -->
  <script
    async
    src="https://www.googletagmanager.com/gtag/js?id=G-HGLWRKMWZE"
  ></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "G-HGLWRKMWZE");
  </script>
  <!-- Google tag (gtag.js) -->
  <script
    async
    src="https://www.googletagmanager.com/gtag/js?id=G-JY64H3024L"
  ></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "G-JY64H3024L");
  </script>
  <script type="text/javascript">
    // js for slider
      const slides = document.querySelectorAll(".slide");
      var counter = 0;

      slides.forEach((slide, index) => {
        slide.style.left = `${index * 100}%`;
      });

      const goPrev = () => {
        counter--;
        slideImage();
      };
      const goNext = () => {
        if (counter < slides.length - 1) {
          counter++;
          slideImage();
        }
      };

      const slideImage = () => {
        slides.forEach((slide) => {
          slide.style.transform = `translateX(-${counter * 100}%)`;
        });
      };

      // js functions on icon click
      function showHideProfileSection() {
        console.log(
          document.getElementById("chatUI").classList.contains("chat__conversation")
        );
        if (
          document.getElementById("chatUI").classList.contains("chat__conversation")
        ) {
          hideProfileSection();
        } else {
          showProfileSection();
        }
      }

      function showProfileSection() {
        document.getElementById("chatUI").classList.add("chat__conversation");
        document.getElementById("profileUI").classList.add("chat__information");
        document.getElementById("profileUI").classList.add("personal-info-mob");
        document.getElementById("profileUI").classList.add("personal-info-tab");
        document.getElementById("profileUI").classList.remove("no-profile");
        document.getElementById("chatUI").classList.remove("expanded-chat");
      }

      function hideProfileSection() {
        document.getElementById("chatUI").classList.remove("chat__conversation");
        document.getElementById("profileUI").classList.remove("chat__information");
        document.getElementById("profileUI").classList.remove("personal-info-mob");
        document.getElementById("profileUI").classList.remove("personal-info-tab");
        document.getElementById("profileUI").classList.add("no-profile");
        document.getElementById("chatUI").classList.add("expanded-chat");
      }

      function showChatConversationSection() {
        document.getElementById("chatUI").classList.add("chat-mob");
      }

      function showChatListSection() {
        document.getElementById("chatUI").classList.remove("chat-mob");
      }

      window.onload = function() {

        loadCategoryButtonEventListener();

        // Check if the user has already clicked "Yes"
        var userHasConfirmed = document.cookie.split(';').some((item) => item.trim().startsWith('over18='));

        // If the user has not clicked "Yes", show the modal and overlay
        if (!userHasConfirmed) {
            var modal = document.getElementById("myModal");
            var overlay = document.getElementById("overlay");

            document.getElementById('yesButton').addEventListener('click', function() {
                modal.style.display = "none";
                overlay.style.display = "none";
                // Set a cookie that expires in 30 days
                var date = new Date();
                date.setTime(date.getTime() + (30 * 24 * 60 * 60 * 1000));
                var expires = "; expires=" + date.toUTCString();
                document.cookie = "over18=yes" + expires + "; path=/";
            });

            document.getElementById('noButton').addEventListener('click', function() {
                window.location.href = 'https://www.google.com/';
            });

            modal.style.display = "block";
            overlay.style.display = "block";
        }

        fetch('/is_premium')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok: ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                if (data.is_premium) {
                    isUserPremium = true;
                } else {
                    document.querySelectorAll('.prem-box input').forEach(input => {
                        input.disabled = true;
                    });
                }
            })
            .catch((error) => {
                console.error('Error checking premium status:', error);
            });

        document.querySelector('.menu-button').addEventListener('click', function() {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('active');
        });

        // Setup the report modal
        document.getElementById('reportImage').addEventListener('click', function() {
            document.getElementById('reportModal').style.display = 'block';
        });

        // Setup the send report button
        document.getElementById('sendReportButton').addEventListener('click', function() {
            var reportReason = document.getElementById('reportReason').value;
            sendReport(reportReason);
        });

        let isUserPremium = false; // Initial value, assuming the user is not premium.
        let countdown = 79; // Start with a delay of 10 seconds
        let interval;
        let img = document.getElementById('generatedImgPath'); // Declare img variable at a higher scope

        function loadCategoryButtonEventListener() {
            const categories = document.querySelectorAll('.category-section-body');

            // Function to toggle active class
            const toggleActiveClass = (event) => {
                const children = event.currentTarget.children;
                for (let i = 0; i < children.length; i++) {
                    const currentChild = children[i];
                    if (currentChild.value == event.target.value) {
                        event.target.classList.add('active');
                    } else {
                        currentChild.classList.remove('active');
                    }
                }
            };

            // Add event listener to each category
            categories.forEach((category) => {
                category.addEventListener('click', toggleActiveClass);

                // Set the first button in each category as active by default
                if (category.children.length > 0) {
                    category.children[0].classList.add('active');
                }
            });
        }

        let imagesToDisplay = null;
        let countdownFinished = false;
        let message = null;
        let currentUniqueId = null;

        function startQueueCountdown() {
            countdown = isUserPremium ? 25 : 79; // 30 seconds for premium users, 79 for others
            document.getElementById('queueSection').style.display = 'block';
            document.getElementById('skipLineOption').style.display = 'block';
            interval = setInterval(updateQueue, 1000);
        }

        function generateImage(textInput, negativePrompt, gender, ethnicity, hairColor, face, hairStyle, eyesColor,
            outfit, places, race, accessories, no_watermark, private_gallery, image_size, quality, img_grid, seed, currentUniqueId) {

            startQueueCountdown(); // Call the startQueueCountdown function

            const body = JSON.stringify({
                text_input: textInput,
                negative_prompt: negativePrompt,
                gender: gender,
                ethnicity: ethnicity,
                hairColor: hairColor,
                face: face,
                hairStyle: hairStyle,
                eyesColor: eyesColor,
                outfit: outfit,
                places: places,
                race: race,
                accessories: accessories,
                no_watermark: no_watermark,
                private_gallery: private_gallery,
                img_size: image_size,
                num_images: img_grid,
                quality: quality,
                seed: seed,
                uniqueId: currentUniqueId
            });
            console.log("=========  ", body)
                // Emit a socket event to send the data to the server
            socket.emit('generate_image', body);

            // Log the data being sent (optional, for debugging purposes)
            console.log("Data sent to the server: ", body);
        }

        function displayImages(images) {
            let imagesContainer = document.getElementById('imagesContainer');
            imagesContainer.innerHTML = ''; // Clear existing images

            images.forEach(image => {
                let img = document.createElement('img');
                img.src = image; // Assuming the image URL is in the 'url' field
                imagesContainer.appendChild(img);
            });
        }

        function updateQueue() {
            document.getElementById('generate_button').disabled = true;
            if (countdown > 0) {
                if (isUserPremium) {
                    document.getElementById('queueStatus').textContent = `Your hentai is loading in... (${countdown}) seconds.`;
                } else {
                    document.getElementById('queueStatus').textContent = `Your queue is up in (${countdown}) seconds.`;
                }
                countdown--;
            } else {
                countdownFinished = true
                if (isUserPremium) {
                    document.getElementById('queueStatus').textContent = 'Yay, your hentai loaded!';
                } else {
                    document.getElementById('queueStatus').textContent = 'Your queue is now ready!';
                }

                clearInterval(interval);
                document.getElementById('skipLineOption').style.display = 'none'; // Hide the skip link when the queue is ready
                // console.log("images not null", countdownFinished, imagesToDisplay)
                if (countdownFinished && imagesToDisplay) {
                    displayImages(imagesToDisplay); // Ensure you pass the appropriate arguments
                    document.getElementById('queueStatus').textContent = message;
                    document.getElementById('generate_button').disabled = false;
                } else {
                    console.error('No images available to display.');
                    document.getElementById('generate_button').disabled = false;
                }
            }
        }

        document.getElementById('open-info-popup').addEventListener('click', function() {
            document.getElementById('info-popup-container').style.display = 'block';
        });

        document.getElementById('close-info-popup').addEventListener('click', function() {
            document.getElementById('info-popup-container').style.display = 'none';
        });

        // Open the guide popup
        document.getElementById('open-guide-popup').addEventListener('click', function() {
            document.getElementById('guide-popup-container').style.display = 'block';
        });

        // Close the guide popup
        document.getElementById('close-guide-popup').addEventListener('click', function() {
            document.getElementById('guide-popup-container').style.display = 'none';
        });

        // Open the FAQ popup
        document.getElementById('open-faq-popup').addEventListener('click', function() {
            document.getElementById('faq-popup-container').style.display = 'block';
        });

        // Close the FAQ popup
        document.getElementById('close-faq-popup').addEventListener('click', function() {
            document.getElementById('faq-popup-container').style.display = 'none';
        });

        document.querySelectorAll('.feature-button').forEach(button => {
            button.addEventListener('click', function() {
                this.classList.toggle('active');
            });
        });

        const socket = io({autoConnect: false});

        socket.on('connect', function() {
            currentUniqueId = uuid.v4();
            console.log("Socket connected from frontend!! Track ID:", currentUniqueId);
            socket.emit('user_connected', { track_id: currentUniqueId });  // Changed event name here
        });

        socket.connect();

        socket.on("webhook", function(data) {
            console.log("++++webhook+++++", data)
            if (data.uniqueId === currentUniqueId ) {
                if (data.status === 'success') {
                    document.getElementById('queueStatus').textContent = 'Image successfully generated!';
                    imagesToDisplay = data.images;
                    message = 'Image generated.'
                } else if (data.status === 'rateLimitExceeded') {
                    imagesToDisplay = ['https://aihentaigenerator.net/wp-content/uploads/2023/11/AIGDefaultimage1.png'];
                    message = 'Image generation failed. Please try again.'
                } else if (data.status === 'error') {
                    imagesToDisplay = ['https://aihentaigenerator.net/wp-content/uploads/2023/11/AIGDefaultimage1.png'];
                    message = 'Image generation failed. Please try again.'
                }
                document.getElementById('generate_button').disabled = false;
                document.getElementById('skipLineOption').style.display = 'none';
            }
        });

        function sendMessage(question, character, state) {
            const data = {
                question: question,
                character: character,
                state: state
            };
            socket.emit('send_message', data);
            console.log("Data sent to the server: ", data);
        }

        document.getElementById('chatForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const question = document.getElementById('question').value;
            const character = document.getElementById('character').value;
            const state = {
                // Add state parameters here if needed
            };
            sendMessage(question, character, state);
        });

        socket.on('receive_message', function(data) {
            const chatHistory = document.getElementById('chatHistory');
            const response = JSON.parse(data);
            const visibleHistory = response.results[0].history.visible;

            visibleHistory.forEach((msg, index) => {
                const messageElement = document.createElement('div');
                messageElement.classList.add(index % 2 === 0 ? 'receiver-msg-box' : 'deliver-msg-box');
                messageElement.innerHTML = `
                    <small>${msg}</small>
                    <div class="text-right"><span>${new Date().toLocaleTimeString()}</span></div>
                `;
                chatHistory.appendChild(messageElement);
            });

            chatHistory.scrollTop = chatHistory.scrollHeight; // Scroll to bottom
        });
      }
  </script>
  <script src="{{ url_for('static', filename='script.js') }}"></script>
</html>
